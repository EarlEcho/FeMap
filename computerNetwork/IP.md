# IP协议 （Internet Protocol）

IP是整个TCP/IP中非常重要的一个协议，主要负责将数据包发送给最终的目标计算机，位于网络层。
（上面这句话太过于笼统，需要改正，后续加上ip的数据结构）

IP地址（IPv4地址），由32位正整数来表示，IP地址由 `网络标识`和`主机标识`两部分组成。

## 一. IP地址的分类
IP地址分为四个级别，A / B / C / D 4个类，基本结构如下图所示：
<img src="../static/img/IP地址分类.png"></img>

要注意的是：在分配IP地址时，要用比特位表示主机地址时，不可以全部为0或者全部为1，因为全部为0只有在表示对应的网络地址或IP地址不可获知的情况下才使用，而全部为1的主机地址通常作为广播地址。

## 二. IPv4结构

IPv4的数据包基本结构如下图所示：
<img src="../static/img/IPv4结构.png"></img>

可以看到IPv4数据包主要由两部分组成：`IP首部 / IP载荷`（即数据）。
而在IP首部中，有很多的信息：

1. **版本**： 该信息长度为`4bit`，表示标识IP首部的版本号，IPv4的版本号即为4，所以在这个字段上的值也是4，而IP其实是有很多版本的，不同的值表示不同的IP版本，比如我们知道的IPv6的版本号为6。
2. **首部长度**（IHL - Internet Header Length）：长度为`4bit`，表示IP首部的大小，在表示IP首部的大小时，它的单位为 `4字节，即32bit`，即每个数值代表4字节，对于没有可选项的IP包，可选项一般设为`5`，也就是说，当没有可选项时，IP包的首部长度为`5*4=20字节`。而4bit的取之范围为`0-15`，所以首部长度最大可以设为`15`，所以首部长度最大可以是`4*15=60字节`
3. **区分服务**（TOS - Type Of Service）：长度为8bit，用来表明服务质量。
4. **总长度**：表示IP数据包（IP首部+数据部分）的长度，长度为`16bit`，所以IP数据包的最大长度为`2的16次方 = 65535字节`
5. **标识**
6. **标志**
7. ****

## 二. 广播地址

广播地址用于在同一个链路中相互连接的主机之间发送数据包，将IP地址的主机地址部分全部设置为1，就成为了广播地址。
而广播分为：
* 本地广播 —— 在本网络内的广播
* 直接广播 —— 在不同网络之间的广播

⚠️ 广播无法穿透路由

## 三. IP多播

多播用于将包发送给特定组内的主机，由于其直接使用IP协议，所以不存在可靠传输。
多播使用D类地址
 

## IPv6 

IPv6是为了根本解决IPv4地址耗尽的问题而被标准化的网际协议。
IPv4的地址长度一般为4个8位字节，即32bit，而IPv6的地址长度是原来的4倍，即128bit，一般写成8个16位字节。
